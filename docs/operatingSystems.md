## 操作系统基础

?> 操作系统极简教程：https://mp.weixin.qq.com/s/p7AUCjig126UFOCruyD15A

**定义**：有效组织何管理系统中的各种软/硬件资源，合理地组织计算机系统工作流程，控制程序的执行，并向用户提供一个良好的工作环境和友好接口的[系统软件](https://zh.wikipedia.org/wiki/%E7%B3%BB%E7%BB%9F%E8%BD%AF%E4%BB%B6)。

**作用**：通过 CPU 管理、存储管理、设备管理和文件管理对各种资源进行合理的分配，改善资源的共享和利用程度，最大限度的发挥计算机系统的工作效率，提高计算机系统在单位时间内处理工作的能力（即系统的“吞吐量”）。

**特征**：并发性、共享性、虚拟性和不确定性。

**主要功能**：处理机管理、文件管理、存储管理、设备管理和作业管理。

?> [处理机](https://baike.baidu.com/item/%E5%A4%84%E7%90%86%E6%9C%BA)包括中央处理器，主存储器，输入-输出接口，加接外围设备就构成完整的计算机系统。**处理机是处理计算机系统中存储程序和数据，并按照程序规定的步骤执行指令的部件**。程序是描述处理机完成某项任务的指令序列。指令则是处理机能直接解释、执行的信息单位。

?> 时间片（timeslice）又称为“量子（quantum）”或“处理器片（processor slice）”是分时操作系统分配给每个正在运行的进程微观上的一段CPU时间（在抢占内核中是：从进程开始运行直到被抢占的时间）。[时间片](https://zh.wikipedia.org/wiki/%E6%97%B6%E9%97%B4%E7%89%87)由操作系统内核的调度程序分配给每个进程。

?> [作业](https://baike.baidu.com/item/%E4%BD%9C%E4%B8%9A/17331008)，系统为完成一个用户的计算任务或一次事务处理所做的工作总和。

![操作系统分类及特点](https://cdn.jsdelivr.net/gh/ssmath/mypic/img/20200214194901.png)

## 进程与线程

**进程**是资源分配和独立运行的基本单位。进程通常由程序、数据和[进程控制块](https://baike.baidu.com/item/%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%9D%97)（PCB）组成。传统进程的两个基本属性为：可拥有资源的独立单位；可独立调度和分配的基本单位。线程的引入将这两属性分开了，**线程**调度和分配的基本单元，**进程**为独立分配资源的基本单元。线程有用户级别线程（User-Level Threads）和内核支持型线程（Kernel-Supported Threads）之分。

### 进程状态描述与切换的三态模型、五态模型和七态模型

进程管理也称为处理机管理。

**三态模型**

![三态模型](https://cdn.jsdelivr.net/gh/ssmath/mypic/img/20200214202300.png)

**五态模型**

![五态模型](https://cdn.jsdelivr.net/gh/ssmath/mypic/img/20200214201937.png)

**七态模型**

![七态模型](https://cdn.jsdelivr.net/gh/ssmath/mypic/img/20200214202415.png)

### 进程间的通信

进程间的**同步**：在系统中需要互相合作，协同工作的进程之间的**相互联系**。

进程间的**互斥**：在系统中多个进程因争用临界资源（Critical Resource）而互斥执行。常见的临界资源有打印机、共享变量等。

[多进程同步的案例：生产者消费者问题](https://zh.wikipedia.org/zh-hans/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98)

关于解决进程同步与互斥的方法、工具：

- 信号量机制（低级通信）
- 高级通信原语
  - 共享存储模式
  - 消息传递模式
  - 管道通信，**管道**，即用于连接一个读进程和写进程，以实现它们之间通信的共享文件

### 进程调度

常见进程调度算法

- 先来先服务
- 时间片轮转
  - 固定时间片
  - 可变时间片
- 优先级调度
  - 静态优先级
  - 动态优先级
- 多级反馈调度

### 死锁

**死锁**：当两个以上的运算单元（进程），双方都在等待对方停止运行，以获取对方在使用的系统资源，但是没有一方提前退出时，就称为[死锁](https://zh.wikipedia.org/wiki/%E6%AD%BB%E9%94%81)。

- 死锁产生的四个必要条件
  - 互斥
  - 请求保持
  - 不可剥夺
  - 环路
- 死锁解除的方法
  - 资源剥夺
  - 撤销进程
- 死锁检测、死锁避免（Dijkstra [银行家算法](https://zh.wikipedia.org/zh-cn/%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95)）

## 内存

> 参考：极客时间-Linux性能优化实战

### 内存映射机制

内存映射，其实就是将虚拟内存地址映射到物理内存地址。内核每个进程维护了一张页表，记录虚拟地址与物理地址的映射关系。

内存管理单元 MMU：https://zhuanlan.zhihu.com/p/73696670

### 缺页异常

!> 进程访问的虚拟地址在页表中查不到时，系统会产生一个缺页异常。

### 分配与内存回收机制

- 内存分配
  - 对小块内存（小于 128K），C 标准库使用 brk() 来分配，也就是通过移动堆顶的位置来分配内存。这些内存释放后并不会立刻归还系统，而是被缓存起来，这样就可以重复使用。
  - 大块内存（大于 128K），则直接使用内存映射 mmap() 来分配，也就是在文件映射段找一块空闲内存分配出去。
- 内存回收
  - 缓存回收，LRU 算法（回收最近最少使用的内存）。
  - OOM 机制，内存占用紧张时，直接杀死占用大量内存的进程。
  - 回收不常访问的内存。

>内存回收机制，避免某个进程用完所有内存。
