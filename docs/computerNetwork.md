# 计算机网络基础

## OSI七层模型、TCP/IP四层模型

![OSI七层模型](https://i.loli.net/2020/03/22/RSLPkrfd3AsmcyC.jpg)

![OSI七层模型、TCP/IP四层模型](https://i.loli.net/2020/03/22/qthHTNlXyOvEfm3.png)

## HTTP

- **HTTP 1.0**：一个 TCP 连接只可以发送一个 HTTP 请求，每次请求都需要重新建立和断开 TCP 连接
- **HTTP 1.1**：引入持久连接，使用 Header 头 `Connection: keep-alive`维持持久连接，一个连接可发送多个 HTTP 请求（但一个时刻只能发送一个），response 使用  `Connection: close` Header 断开连接
- **HTTP 2.0**：多路复用，一个 TCP 连接中可同时完成多个 HTTP 请求

>参考：
>[HTTP/1.x 的连接管理](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Connection_management_in_HTTP_1.x#HTTP_%E6%B5%81%E6%B0%B4%E7%BA%BF)
>[你猜一个 TCP 连接上面能发多少个 HTTP 请求](https://zhuanlan.zhihu.com/p/61423830)

### Session与Cookie

- Session 是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中；
- Cookie 是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现 Session 的一种方式。

## TCP三次握手建立TCP连接

![TCP三次握手](https://i.loli.net/2020/03/22/vRaQ5k26BiFbZqg.png)

- **序列号 seq**：所发送字节流的第一个字节的编号
- **确认号 ack**：期望收到的下一个报文段的序号。
- **ACK**：控制位 ACK=1 表示数据已收到，TCP 规定，在连接建立后所有传送的报文段都必须把 ACK 置 1
- **同步 SYN**：控制位，在连接建立时用来同步序号。当 SYN=1，ACK=0 时表示这是一个连接请求报文段。若对方同意建立连接，则响应报文中 SYN=1，ACK=1。


?> **为什么需要三次握手**：为了防止已失效的**连接请求报文段**突然又传送到了服务端，占用服务器资源。（如果是两次握手，服务端接收到的可能是已经超时才传到连接请求报文，客户端已经不承认了）。

## TCP四次挥手结束TCP连接

![TCP四次挥手](https://i.loli.net/2020/03/22/ApsXC7E1Mwzdqae.png)

一二次握手（客户端测连接关闭），三四次握手（服务端一侧连接关闭）。

- **终止 FIN**：控制位，用来释放一个连接，当 FIN=1 时，表示此报文段的发送方的数据已发送完毕，并要求释放连接。

!> 服务端的 CLOSE-WAIT 状态：为了让服务器端发送还未传送完毕的数据，传送完毕之后，服务器会发送 FIN 连接释放报文。

!> 客户端的 TIME—WAIT 状态：等待一个时间计时器设置的时间 2MSL(maximium segment lifetime，最长报文寿命)。确保最后一个确认报文段能够到达，同时让本连接持续时间内所产生的所有报文段都从网络中消失，使得下一个新的连接不会出现旧的连接请求报文段。

参考：[跟着动画来学 TCP 三次握手和四次挥手](https://juejin.im/post/5b29d2c4e51d4558b80b1d8c)

# 面试题

参考：https://www.bilibili.com/video/BV1gk4y1o7pX

## 1、请详细介绍下 TCP 的三次握手机制，为什么需要三次握手？

第一次握手，


- 为什么需要握手，为什么是三次握手？

因为 TCP 有个重要的特性即为**可靠性**，发送方发了消息，接受方需回应收到了，不然就重发。通过对消息进行编号（序列号sequence，不能从 0 开始）证明消息发过去了。握手的一个重要作用就是同步序列号，还可以同步滑动窗口和MSL等。

为什么是三次握手？以稳定性为着眼点，我们会认为是 4 次握手（关连接的时候就是 4 次），关连接的时候连接可以处于半打开状态继续传输消息（server 关连接了，但是 client 没有关连接，client 仍然可以长时间的去发送消息「只要server没有强制关闭连接」），但是建立连接的时候不能是半打开状态。如果是两次呢？如果是两次握手，服务端接收到的可能是已经超时才传到连接请求报文，客户端已经不承认了，此时服务端的资源会被占用。

## 2、在地址栏输入URL后，网络世界发生了什么？

看点：

- DNS查询、缓存、代理
- HTTP 请求编码，地址输入后，HTTP 请求的格式是怎么样的
- 报文消息如何传输到服务器（网络分层，各层解决了什么）
- 等等

## 3、TCP 和 UDP 的区别

- TCP
  - 传递任意长度消息
  - 可靠
  - 流量控制
  - 拥塞控制

- UDP
  - 一对多
  - 效率高，header短，有效信息占比高
  - 简单
  - 实时性好
    - 无队头阻塞

!> 队头阻塞：当第一个数据包发生丢包的时候，TCP协议会发生阻塞会进行数据重传。虽然TCP有快速重传等机制来缓解这个问题，但是只能是缓解。

## 4、使用 HTTP 长连接有何有优点

- 减少握手次数，每次连接建立与断开共七次握手，4 个请求就有 28 次握手，长连接只有 7 次
- 减少慢启动影响：虽然 TCP 可以传递任意长度的消息，因为网络带宽有限，所需发送时的速率会从低转高。
- 缺点：可能会遭遇队头阻塞

> 短连接，HTTP header 的 conection为 close。

## 5、服务器的最大并发连接数是多少

端口号并不能限制并发连接数，端口号的作用是在网络连接中标识应用层的进程，一个服务端进程可服务于 n 个客户远程进程。

并发连接数由 TCP 四元组决定。

TCP 四元组：IP 报头（源 IP 和 目标 IP），TCP 报头（源端口和目的端口）「端口与进程关联」。

连接数：2^{32+16}，16 bits 存储端口号，32 bits存储 IP 地址。

Linux 端口开放收限制，可能需要手动打开。

## 6、TLS/SSL 协议是怎样保障信息安全的

- PKI 证书体系
- 密钥交换协议（握手谈好使用的协议）
- 对称加密算法交换密钥
